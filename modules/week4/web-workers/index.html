<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4.1 Web and Service Workers | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/W2022/assets/css/0.styles.e8f982fe.css" as="style"><link rel="preload" href="/W2022/assets/js/app.86fc79ff.js" as="script"><link rel="preload" href="/W2022/assets/js/2.644458f3.js" as="script"><link rel="preload" href="/W2022/assets/js/17.75c09ace.js" as="script"><link rel="preload" href="/W2022/assets/js/8.c8690475.js" as="script"><link rel="preload" href="/W2022/assets/js/10.e0709425.js" as="script"><link rel="prefetch" href="/W2022/assets/js/11.03dd7ca9.js"><link rel="prefetch" href="/W2022/assets/js/12.099d5a86.js"><link rel="prefetch" href="/W2022/assets/js/13.2bd6007b.js"><link rel="prefetch" href="/W2022/assets/js/14.e0a43227.js"><link rel="prefetch" href="/W2022/assets/js/15.092d6948.js"><link rel="prefetch" href="/W2022/assets/js/16.859f074a.js"><link rel="prefetch" href="/W2022/assets/js/18.a6e526dd.js"><link rel="prefetch" href="/W2022/assets/js/19.bb7ee112.js"><link rel="prefetch" href="/W2022/assets/js/20.97f8b97a.js"><link rel="prefetch" href="/W2022/assets/js/21.23d3ef6f.js"><link rel="prefetch" href="/W2022/assets/js/22.933a5f9c.js"><link rel="prefetch" href="/W2022/assets/js/23.4a816fa9.js"><link rel="prefetch" href="/W2022/assets/js/24.4b4b432d.js"><link rel="prefetch" href="/W2022/assets/js/25.cd556980.js"><link rel="prefetch" href="/W2022/assets/js/26.ba97292d.js"><link rel="prefetch" href="/W2022/assets/js/27.cd63cd1f.js"><link rel="prefetch" href="/W2022/assets/js/28.7c415eed.js"><link rel="prefetch" href="/W2022/assets/js/29.cfd0de32.js"><link rel="prefetch" href="/W2022/assets/js/3.bca6a9a1.js"><link rel="prefetch" href="/W2022/assets/js/30.914c8d51.js"><link rel="prefetch" href="/W2022/assets/js/31.7bc52ca8.js"><link rel="prefetch" href="/W2022/assets/js/32.e7e81d1c.js"><link rel="prefetch" href="/W2022/assets/js/33.b0178163.js"><link rel="prefetch" href="/W2022/assets/js/34.849cc443.js"><link rel="prefetch" href="/W2022/assets/js/35.37fdb7ab.js"><link rel="prefetch" href="/W2022/assets/js/36.0c0d987a.js"><link rel="prefetch" href="/W2022/assets/js/37.be9d0dcc.js"><link rel="prefetch" href="/W2022/assets/js/38.1c08ef56.js"><link rel="prefetch" href="/W2022/assets/js/39.10bff2ae.js"><link rel="prefetch" href="/W2022/assets/js/4.e2498dd6.js"><link rel="prefetch" href="/W2022/assets/js/40.8fe54bd5.js"><link rel="prefetch" href="/W2022/assets/js/41.42838ccb.js"><link rel="prefetch" href="/W2022/assets/js/42.241ccad7.js"><link rel="prefetch" href="/W2022/assets/js/43.458ecccd.js"><link rel="prefetch" href="/W2022/assets/js/44.07fdfe33.js"><link rel="prefetch" href="/W2022/assets/js/45.2da207c2.js"><link rel="prefetch" href="/W2022/assets/js/46.51fffa86.js"><link rel="prefetch" href="/W2022/assets/js/47.65aed37a.js"><link rel="prefetch" href="/W2022/assets/js/5.02d60a9c.js"><link rel="prefetch" href="/W2022/assets/js/6.40785f8b.js"><link rel="prefetch" href="/W2022/assets/js/7.c2b7ff19.js"><link rel="prefetch" href="/W2022/assets/js/9.ec48c5f9.js">
    <link rel="stylesheet" href="/W2022/assets/css/0.styles.e8f982fe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/W2022/" class="home-link router-link-active"><!----> <span class="site-name">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/W2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2022/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/W2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2022/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/W2022/modules/week1/file-formats/" class="sidebar-link">1.1: File Formats</a></li><li><a href="/W2022/modules/week1/data-structures/" class="sidebar-link">1.2: Data Structures</a></li><li><a href="/W2022/modules/week2/cookie-webstorage/" class="sidebar-link">2.1: Cookies, LocalStorage, Cache</a></li><li><a href="/W2022/modules/week2/indexeddb/" class="sidebar-link">2.2: IndexedDB</a></li><li><a href="/W2022/modules/week3/code-organizing/" class="sidebar-link">3.1: ES Modules</a></li><li><a href="/W2022/modules/week3/continuous-delivery/" class="sidebar-link">3.2: Github and Netlify</a></li><li><a href="/W2022/modules/week4/web-workers/" aria-current="page" class="active sidebar-link">4.1: Asynchronous Code &amp; Workers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week4/web-workers/#asynchronous-vs-synchronous" class="sidebar-link">Asynchronous vs Synchronous</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week4/web-workers/#core-javascript-vs-the-web-apis" class="sidebar-link">Core JavaScript VS. the Web APIs</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week4/web-workers/#the-javascript-loop" class="sidebar-link">The JavaScript Loop</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2022/modules/week4/web-workers/#async-await" class="sidebar-link">Async Await</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week4/web-workers/#shared-web-workers" class="sidebar-link">Shared Web Workers</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week4/web-workers/#service-worker-intro" class="sidebar-link">Service Worker Intro</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week4/web-workers/#service-worker-playlist" class="sidebar-link">Service Worker Playlist</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2022/modules/week4/web-workers/#what-to-do-this-week" class="sidebar-link">What to do this week</a></li></ul></li><li><a href="/W2022/modules/week4/service-workers/" class="sidebar-link">4.2: Service Workers</a></li><li><a href="/W2022/modules/week5/manifest-install/" class="sidebar-link">5.1: Web Manifests and PWA Installs</a></li><li><a href="/W2022/modules/week5/api-fetch/" class="sidebar-link">5.2: APIs and Fetch</a></li><li><a href="/W2022/modules/week6/caching/" class="sidebar-link">6.1: Offline First and Audits</a></li><li><a href="/W2022/modules/week6/install-native/" class="sidebar-link">6.2: More PWA Stuff</a></li><li><a href="/W2022/modules/week7/pwa-project/" class="sidebar-link">7.2: PWA Project</a></li><li><a href="/W2022/modules/reading/" class="sidebar-link">Reading Week</a></li><li><a href="/W2022/modules/week9/flutter-setup/" class="sidebar-link">9.1: Flutter Setup</a></li><li><a href="/W2022/modules/week9/flutter-intro/" class="sidebar-link">9.2: Flutter Intro</a></li><li><a href="/W2022/modules/week10/colors-assets/" class="sidebar-link">10.1: Using Colors and Assets in Widgets</a></li><li><a href="/W2022/modules/week10/layout-widgets/" class="sidebar-link">10.2: Flutter Layout and Widgets</a></li><li><a href="/W2022/modules/week11/navigation/" class="sidebar-link">11.1: Flutter Navigation</a></li><li><a href="/W2022/modules/week11/stateful/" class="sidebar-link">11.2: Stateful Widgets</a></li><li><a href="/W2022/modules/week12/api-1/" class="sidebar-link">12.1: Flutter API Calls I</a></li><li><a href="/W2022/modules/week12/api-2/" class="sidebar-link">12.2: Flutter API Calls II</a></li><li><a href="/W2022/modules/week13/data-persistence/" class="sidebar-link">13.1: Shared Preferences</a></li><li><a href="/W2022/modules/week13/themes/" class="sidebar-link">13.2: Themes, Splash Screens, More</a></li><li><a href="/W2022/modules/week14/" class="sidebar-link">14: Gestures, Dismissable, More</a></li><li><a href="/W2022/modules/week15/" class="sidebar-link">15: Final Project</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title blue">
    Progressive Web Apps
  </div> <h1>4.1 Web and Service Workers</h1></header> <h2 id="asynchronous-vs-synchronous"><a href="#asynchronous-vs-synchronous" class="header-anchor">#</a> Asynchronous vs Synchronous</h2> <p>JavaScript has a mechanism known as the event loop. When you pass a list of commands to the event loop, it will keep running each of those commands in order until it gets to the end of your list. This list is known as the main stack. JavaScript keeps trying to run commands as long as there is something on the main stack.</p> <p>However, sometimes there is a command that would stop the event loop from getting to the next command. It gets blocked from going to the next command in the stack. These types of commands are things that take a long time to complete, like talking to a database, or the file system, or a network request for a file, or a timer that needs to wait before running.</p> <p>There are specific tasks that are going to take too long and they get put into a secondary area so they can wait for their result. These tasks are known as asynchronous.</p> <p>If the code stays on the main stack and insists on being run before the event loop moves on to the next item then it is called synchronous.</p> <h3 id="core-javascript-vs-the-web-apis"><a href="#core-javascript-vs-the-web-apis" class="header-anchor">#</a> Core JavaScript VS. the Web APIs</h3> <p>The JavaScript that we use in the browser is actually made up of two different things.</p> <p>There is the Core JavaScript that we were using with Node.JS for the first few weeks of the semester and there are the Web APIs.</p> <p>The Core part is made up of the features like variables, if statements, functions, data types, arrays, loops, ternary operators, the Math object.</p> <p>The Web APIs are all the things that are added on top for the browser - HTML DOM, CSS style manipulation, handling AJAX requests, timers (setTImeout and setInterval), the browser events, geolocation, local storage, and all the features added to support mobile devices.</p> <p>What is the difference between synchronous and asynchronous JavaScript? Watch this to see:</p> <div title="Asynchronous vs Synchronous" class="video-player"><iframe width="560" height="315" src="https://youtube.com/embed/Q-Zmc0E0GYY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="the-javascript-loop"><a href="#the-javascript-loop" class="header-anchor">#</a> The JavaScript Loop</h3> <p>The JavaScript engines, like Chrome's V8, use a single thread to process all your code. It builds a stack of commands to run, in the order that you have written them. As long as each command belongs to the CORE JavaScript then it gets added to the main run stack.</p> <p>When something that belongs to the Web APIs is encountered it gets added to a secondary list of tasks. Each time the main stack is finished then the JavaScript engine turns it attention to the secondary list of tasks and will try to run those.</p> <p>Here is a great video that explains how the JS Event Loop works.</p> <div title="Event Loop JS Archibald" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/cCOL7MC4Pl0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="async-await"><a href="#async-await" class="header-anchor">#</a> Async Await</h2> <p>When you call an asynchronous method like fetch, loading an image, timers, getting geolocation, talking to a database or reading a file, then we need to handle this in our code. Most asynchronous tasks have a callback method that we can use. Another approach we can use is wrapping the task inside a Promise and then using a then().</p> <p>If you want to use the Promise version but want to simplify your code then we can use the keywords async and await.</p> <p>One of the features added in ES6 was <code>async</code> and <code>await</code>. The combination of these keywords lets us use asynchronous features like <code>fetch</code> inside a function but in a synchronous way.</p> <p>Here is an example.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'https://www.example.com/items/'</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// now we have the actual response object in our response variable</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// now we actually have the JSON data inside the data variable</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>This works by wrapping the asynchronous call in a Promise and making the rest of the function wait for the result before continuing. Without the await the variables response and data would not work properly. response would hold the Promise object which is the fetch waiting for a response. The next line, where we call the json() method would fail because that is not a valid method to call on a fetch or promise object.</p> <p>The await is what solves the problem and makes the code wait for the result of the fetch() and the json() methods.</p> <p>Here are a few videos about <code>Async Await</code>.</p> <div title="Intro to Async Await" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/BTDeq5HC5bU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="Async Await with Promises" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/lGJbPSI-12E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="Async Await with Fetch" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/ycJOZp_wWak" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="shared-web-workers"><a href="#shared-web-workers" class="header-anchor">#</a> Shared Web Workers</h2> <p>By now we are very familiar with the idea that JavaScript runs the main stack on a single thread. This means that the main stack runs in a synchronous way - one task at a time.</p> <p>We do have asynchronous things like Events, Timers, and Promises which will be placed on another thread to be handled. When they are ready to be used they get put in a queue to wait to be added back onto the main stack. They can only be added back onto the main stack when it is empty and all the current tasks are complete.</p> <p>So, if you have a processor intensive task to complete but it isn't connected to a Promise, Timer, or Event then you are stuck with the main stack not able to do anything until it finishes this big task. Updating the interface and interacting with the user in a real-time way could be jeopardized.</p> <p>The solution? Shared Web Workers. With these, we can actually create our own new thread to use and run our complex task on that other thread. Our main stack will, once again, be free to work with the interface and the user.</p> <p>Shared Web Workers can contain practically any code we want, except it is not allow to access the DOM (the interface).</p> <div title="Shared Web Workers" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/EiPytIxrZtU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="service-worker-intro"><a href="#service-worker-intro" class="header-anchor">#</a> Service Worker Intro</h2> <p>Here is a <a href="https://bitsofco.de/web-workers-vs-service-workers-vs-worklets/" target="_blank" rel="noopener noreferrer">great article<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> about the differences between Service Workers, Web Workers, and Worklets. All three are <code>workers</code> meaning that they get launched from a webpage script and they run on a separate thread to offload some processor intensive work.</p> <p><code>Web Workers</code> are just instantiated and run to off load a task.</p> <p><code>Worklets</code> are run to help us do things during the rendering process on the page. They do NOT have access to the DOM.</p> <p><code>Service Workers</code> get registered | installed and remain in the browser. They run in the background and act as a proxy server to intercept all the file requests that come from the browser. They can work with <code>fetch</code>, the <code>cache API</code>, and the <code>indexedDB API</code> to help you build offline first web apps. They do NOT have access to the DOM.</p> <h4 id="registering-and-installing-service-workers"><a href="#registering-and-installing-service-workers" class="header-anchor">#</a> Registering and Installing Service Workers</h4> <p>Registering a service worker for your website can be quite simple.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/service-worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The <code>serviceWorker</code> object exists inside the <code>window.navigator</code> object. You can call the file that holds your service worker anything that you want but it should be saved at the root of your website.</p> <p>When you register the file it will automatically be applied to EVERY tab and EVERY webpage under the current domain.</p> <p>If you are working on a project that is running in Chrome under <code>http://127.0.0.1:5500</code> and you register a Service Worker then it will remain there and apply to every webpage from <code>http://127.0.0.1/</code> that you open on Chrome until you remove it yourself through the Chrome Dev tools.</p> <p>If you want to see if a Service Worker is currently running for your webpage, you can use this:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myController <span class="token operator">=</span> navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If there is an active Service Worker then it will be assigned to <code>myController</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do a one-off check to see if a service worker's in control.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">This page is currently controlled by: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This page is not currently controlled by a service worker.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Service workers are not supported.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="life-cycle-for-service-workers"><a href="#life-cycle-for-service-workers" class="header-anchor">#</a> Life-cycle for Service Workers</h4> <p>The life cycle for service workers has two critical events <code>install</code> and <code>activate</code>. When you call the <code>register</code> method for the service worker, the browser will check to see if this specific file has previously been installed. If not, then it will install it and trigger the <code>install</code> event.</p> <p>If the file was previously installed but there is a change to the code inside the file then it will trigger a new installation of the script. Service workers are installed for a specific domain. They are tied to the current domain.</p> <p>The <code>activate</code> event happens when a service worker has been installed and there is no other service worker currently running on any tab in the browser for the current domain. As long as there is still an older service worker running, the browser will not want to active the new file or new version.</p> <p>If you load your webpage once and the browser <code>install</code>s and <code>activate</code>s a service worker, then you edit the service worker and reload your webpage, the browser will <code>install</code> but <strong>NOT</strong> <code>activate</code> the new version because the older one is still active and running. Refreshing a second time will unload the old one and <code>activate</code> the newest version that is installed.</p> <p>Once activated the service worker can handle events for <code>fetch</code> and messaging between the worker and the webpage.</p> <p>The <code>install</code> event is the best time to create any new version of the file cache array that you will need for your new service worker.</p> <p>The <code>activate</code> event is when you would delete old versions of the file cache.</p> <p>If you want to update your IndexedDB then you can open the new version of the database from your <code>activate</code> event and use the <code>upgradeneeded</code> event to make any structural changes you want there.</p> <p>Inside your Service Worker file you can add listeners for the <code>install</code> and <code>activate</code> events. The keyword <code>self</code> is used in the service worker script to refer to itself.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//code to run when the install event happens</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//code to run when the service worker becomes active</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Since, the manner in which cached files, database access, and fetch calls are handled, can be very sensitive to the specific version of the client side script in the browser we have to be able to manage the installing and activating of these shared service workers.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>installing -&gt; installed -&gt; waiting -&gt; activating -&gt; activated -&gt; idle -&gt; stopped -&gt; terminated
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The <code>idle</code> phase happens when the webpage is still active but the service worker has nothing to do.</p> <p>The <code>stopped</code> phase happens when the tabs for the current domain are all closed. The service worker is still registered and installed but it is dormant. Once another page for that domain is loaded, the Service Worker can become activated again.</p> <p>The <code>terminated</code> phase happens when a service worker is unregistered | uninstalled. This must happen before a new service worker for the domain gets activated.</p> <p><img src="/W2022/assets/img/lifecycle.1d49eede.png" alt="lifecycle image"></p> <p><a href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle" target="_blank" rel="noopener noreferrer">More reading on the lifeCycle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="dev-tools-for-service-workers"><a href="#dev-tools-for-service-workers" class="header-anchor">#</a> Dev Tools for Service Workers</h4> <p>In Chrome, we can use the <code>Application</code> tab in the Dev Tools to find everything we need to work with Service Workers. Service Worker Registration, IndexedDB, localStorage, Cookies, Caches, Manifest, and Background Services are all found in this tab.</p> <h3 id="service-worker-playlist"><a href="#service-worker-playlist" class="header-anchor">#</a> Service Worker Playlist</h3> <p>Here is a whole playlist tutorial on how to build and use Service Workers.</p> <p><a href="https://www.youtube.com/watch?v=NJRu3pmmN-4&amp;list=PLyuRouwmQCjl4iJgjH3i61tkqauM-NTGj" target="_blank" rel="noopener noreferrer">Service Worker Playlist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The videos in the playlist are:</p> <ol><li>Registration, Life-Cycle, Events, and Dev Tools</li> <li>The Cache API</li> <li>waitUntil, skipWaiting, claim</li> <li>How to integrate Caches</li> <li>The Storage API</li> <li>Controlling Fetch Calls</li> <li>When Fetch Goes Wrong</li> <li>Messaging Between Tabs and Service Workers</li> <li>Integrating a Database</li></ol> <h2 id="what-to-do-this-week"><a href="#what-to-do-this-week" class="header-anchor">#</a> What to do this week</h2> <div class="custom-block warning"><p class="custom-block-title">TODO</p> <p>Things to do before next week</p> <ul><li>Read and Watch all the course content for <code>4.1</code>, <code>4.2</code>, and <code>5.1</code></li> <li>Complete <a href="/W2022/assignments/hybrid/#_2-feature-branch-and-controls">Hybrid 2</a></li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/13/2022, 10:34:36 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/W2022/modules/week3/continuous-delivery/" class="prev">
        3.2: Github and Netlify
      </a></span> <span class="next"><a href="/W2022/modules/week4/service-workers/">
        4.2: Service Workers
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/W2022/assets/js/app.86fc79ff.js" defer></script><script src="/W2022/assets/js/2.644458f3.js" defer></script><script src="/W2022/assets/js/17.75c09ace.js" defer></script><script src="/W2022/assets/js/8.c8690475.js" defer></script><script src="/W2022/assets/js/10.e0709425.js" defer></script>
  </body>
</html>
