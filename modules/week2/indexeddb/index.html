<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IndexedDB API | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/W2022/assets/css/0.styles.e8f982fe.css" as="style"><link rel="preload" href="/W2022/assets/js/app.86fc79ff.js" as="script"><link rel="preload" href="/W2022/assets/js/2.644458f3.js" as="script"><link rel="preload" href="/W2022/assets/js/39.10bff2ae.js" as="script"><link rel="preload" href="/W2022/assets/js/8.c8690475.js" as="script"><link rel="prefetch" href="/W2022/assets/js/10.e0709425.js"><link rel="prefetch" href="/W2022/assets/js/11.03dd7ca9.js"><link rel="prefetch" href="/W2022/assets/js/12.099d5a86.js"><link rel="prefetch" href="/W2022/assets/js/13.2bd6007b.js"><link rel="prefetch" href="/W2022/assets/js/14.e0a43227.js"><link rel="prefetch" href="/W2022/assets/js/15.092d6948.js"><link rel="prefetch" href="/W2022/assets/js/16.859f074a.js"><link rel="prefetch" href="/W2022/assets/js/17.75c09ace.js"><link rel="prefetch" href="/W2022/assets/js/18.a6e526dd.js"><link rel="prefetch" href="/W2022/assets/js/19.bb7ee112.js"><link rel="prefetch" href="/W2022/assets/js/20.97f8b97a.js"><link rel="prefetch" href="/W2022/assets/js/21.23d3ef6f.js"><link rel="prefetch" href="/W2022/assets/js/22.933a5f9c.js"><link rel="prefetch" href="/W2022/assets/js/23.4a816fa9.js"><link rel="prefetch" href="/W2022/assets/js/24.4b4b432d.js"><link rel="prefetch" href="/W2022/assets/js/25.cd556980.js"><link rel="prefetch" href="/W2022/assets/js/26.ba97292d.js"><link rel="prefetch" href="/W2022/assets/js/27.cd63cd1f.js"><link rel="prefetch" href="/W2022/assets/js/28.7c415eed.js"><link rel="prefetch" href="/W2022/assets/js/29.cfd0de32.js"><link rel="prefetch" href="/W2022/assets/js/3.bca6a9a1.js"><link rel="prefetch" href="/W2022/assets/js/30.914c8d51.js"><link rel="prefetch" href="/W2022/assets/js/31.7bc52ca8.js"><link rel="prefetch" href="/W2022/assets/js/32.e7e81d1c.js"><link rel="prefetch" href="/W2022/assets/js/33.b0178163.js"><link rel="prefetch" href="/W2022/assets/js/34.849cc443.js"><link rel="prefetch" href="/W2022/assets/js/35.37fdb7ab.js"><link rel="prefetch" href="/W2022/assets/js/36.0c0d987a.js"><link rel="prefetch" href="/W2022/assets/js/37.be9d0dcc.js"><link rel="prefetch" href="/W2022/assets/js/38.1c08ef56.js"><link rel="prefetch" href="/W2022/assets/js/4.e2498dd6.js"><link rel="prefetch" href="/W2022/assets/js/40.8fe54bd5.js"><link rel="prefetch" href="/W2022/assets/js/41.42838ccb.js"><link rel="prefetch" href="/W2022/assets/js/42.241ccad7.js"><link rel="prefetch" href="/W2022/assets/js/43.458ecccd.js"><link rel="prefetch" href="/W2022/assets/js/44.07fdfe33.js"><link rel="prefetch" href="/W2022/assets/js/45.2da207c2.js"><link rel="prefetch" href="/W2022/assets/js/46.51fffa86.js"><link rel="prefetch" href="/W2022/assets/js/47.65aed37a.js"><link rel="prefetch" href="/W2022/assets/js/5.02d60a9c.js"><link rel="prefetch" href="/W2022/assets/js/6.40785f8b.js"><link rel="prefetch" href="/W2022/assets/js/7.c2b7ff19.js"><link rel="prefetch" href="/W2022/assets/js/9.ec48c5f9.js">
    <link rel="stylesheet" href="/W2022/assets/css/0.styles.e8f982fe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/W2022/" class="home-link router-link-active"><!----> <span class="site-name">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/W2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2022/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/W2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2022/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/W2022/modules/week1/file-formats/" class="sidebar-link">1.1: File Formats</a></li><li><a href="/W2022/modules/week1/data-structures/" class="sidebar-link">1.2: Data Structures</a></li><li><a href="/W2022/modules/week2/cookie-webstorage/" class="sidebar-link">2.1: Cookies, LocalStorage, Cache</a></li><li><a href="/W2022/modules/week2/indexeddb/" aria-current="page" class="active sidebar-link">2.2: IndexedDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week2/indexeddb/#indexeddb-api" class="sidebar-link">IndexedDB API</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week2/indexeddb/#indexeddb-setup" class="sidebar-link">IndexedDB Setup</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week2/indexeddb/#reading-data-crud" class="sidebar-link">Reading Data (cRud)</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week2/indexeddb/#inserting-data-crud" class="sidebar-link">Inserting Data (Crud)</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week2/indexeddb/#updating-data-crud" class="sidebar-link">Updating Data (crUd)</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week2/indexeddb/#deleting-data-crud" class="sidebar-link">Deleting Data (cruD)</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week2/indexeddb/#using-cursors" class="sidebar-link">Using Cursors</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week2/indexeddb/#what-to-do-this-week" class="sidebar-link">What to do this week</a></li></ul></li><li><a href="/W2022/modules/week3/code-organizing/" class="sidebar-link">3.1: ES Modules</a></li><li><a href="/W2022/modules/week3/continuous-delivery/" class="sidebar-link">3.2: Github and Netlify</a></li><li><a href="/W2022/modules/week4/web-workers/" class="sidebar-link">4.1: Asynchronous Code &amp; Workers</a></li><li><a href="/W2022/modules/week4/service-workers/" class="sidebar-link">4.2: Service Workers</a></li><li><a href="/W2022/modules/week5/manifest-install/" class="sidebar-link">5.1: Web Manifests and PWA Installs</a></li><li><a href="/W2022/modules/week5/api-fetch/" class="sidebar-link">5.2: APIs and Fetch</a></li><li><a href="/W2022/modules/week6/caching/" class="sidebar-link">6.1: Offline First and Audits</a></li><li><a href="/W2022/modules/week6/install-native/" class="sidebar-link">6.2: More PWA Stuff</a></li><li><a href="/W2022/modules/week7/pwa-project/" class="sidebar-link">7.2: PWA Project</a></li><li><a href="/W2022/modules/reading/" class="sidebar-link">Reading Week</a></li><li><a href="/W2022/modules/week9/flutter-setup/" class="sidebar-link">9.1: Flutter Setup</a></li><li><a href="/W2022/modules/week9/flutter-intro/" class="sidebar-link">9.2: Flutter Intro</a></li><li><a href="/W2022/modules/week10/colors-assets/" class="sidebar-link">10.1: Using Colors and Assets in Widgets</a></li><li><a href="/W2022/modules/week10/layout-widgets/" class="sidebar-link">10.2: Flutter Layout and Widgets</a></li><li><a href="/W2022/modules/week11/navigation/" class="sidebar-link">11.1: Flutter Navigation</a></li><li><a href="/W2022/modules/week11/stateful/" class="sidebar-link">11.2: Stateful Widgets</a></li><li><a href="/W2022/modules/week12/api-1/" class="sidebar-link">12.1: Flutter API Calls I</a></li><li><a href="/W2022/modules/week12/api-2/" class="sidebar-link">12.2: Flutter API Calls II</a></li><li><a href="/W2022/modules/week13/data-persistence/" class="sidebar-link">13.1: Shared Preferences</a></li><li><a href="/W2022/modules/week13/themes/" class="sidebar-link">13.2: Themes, Splash Screens, More</a></li><li><a href="/W2022/modules/week14/" class="sidebar-link">14: Gestures, Dismissable, More</a></li><li><a href="/W2022/modules/week15/" class="sidebar-link">15: Final Project</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title red">
    Data Storage
  </div> <h1>IndexedDB API</h1></header> <h2 id="indexeddb-api"><a href="#indexeddb-api" class="header-anchor">#</a> IndexedDB API</h2> <p>Today we are going to learn how to use an <code>IndexedDB</code> to store local data in the browser.</p> <p>Here is an entire <a href="https://www.youtube.com/watch?v=6fK1K28eoUA&amp;list=PLyuRouwmQCjmNyAysdqjNz5fIS5cYU4vi" target="_blank" rel="noopener noreferrer">playlist of videos about IndexedDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The first video talks about using Jake Archibald's <a href="https://github.com/jakearchibald/idb-keyval" target="_blank" rel="noopener noreferrer">idb-keyval library<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as a quick way to get up and running with IndexedDB. The other 8 videos explain how to use IndexedDB with the native built-in browser API.</p> <p>The <code>idb-keyval</code> library lets you manage a data store in IndexedDB if you are able to store your data in a simple structure like you would with <code>localStorage</code>. Think key-value pairs.</p> <p>If you need a more robust data solution then the full native <code>IndexedDB API</code> gives us what we need - the ability to create a bunch of separate data collections each filled with a bunch of JSON-like objects.</p> <p>Later this semester you will be learning how to work with <code>MongoDB</code> in the MAD9124 server-side course. <code>MongoDB</code> is what is known as a <strong>document</strong> database, as opposed to a <strong>relational</strong> database like MySQL.</p> <p>Document databases are comprised of a series of <code>collections</code>. Each <code>collection</code> can have a bunch of <code>documents</code>. Each <code>document</code> is basically a JavaScript Object that has been converted to JSON. Most document databases will convert the JSON string into a binary representation for better compression and performance.</p> <p>If you want to learn about the <code>idb-keyval</code> library then watch the first video in that playlist. Here, and in class, we will be discussing how to use the native <code>IndexedDB API</code>.</p> <p>Just like the <code>Cache API</code>, it has a series of methods that work with Promises.</p> <h2 id="indexeddb-setup"><a href="#indexeddb-setup" class="header-anchor">#</a> IndexedDB Setup</h2> <p>The IndexedDB API allows us to work with the data from both a regular web page script as well as from a Service Worker.</p> <p>The <code>window.indexedDB</code> property is the root property that gives us access to the database. We call the <code>open(dbname, dbversion)</code> method to access a specific database.</p> <p>The structure for the data in the browser is:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>domain -&gt; database(s) -&gt; collections -&gt; documents.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>You can have multiple <code>databases</code>.</p> <p>Each <code>databases</code> can have multiple <code>collections</code> (also called <code>Stores</code>).</p> <p>Each <code>Collection</code>|<code>Store</code> can hold many, many <code>documents</code>.</p> <p>Each <code>document</code> is a JSON string representation of a JS Object.</p> <p>When you open the database you need to pass in the name and version number for the database. If a database with that name and version exist then it will be opened. If it doesn't exist then it will be created and opened.</p> <p>The <code>open</code> command runs asynchronously. It will trigger various events like <code>success</code>,<code>error</code>, and <code>upgradeneeded</code>. You can use <code>addEventListener</code> or the older <code>on...</code> syntax approach to adding the event listener functions.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token constant">DB</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> dbOpenRequest <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'bookDB'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dbOpenRequest<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">DB</span> <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token comment">//if you want to create collections/stores or modify them do it here</span>
  <span class="token comment">//You can write code to make specific DB changes depending on the old db version</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>oldVersion <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//remove a Store|collection</span>
    <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">deleteObjectStore</span><span class="token punctuation">(</span><span class="token string">'bookList'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>oldVersion <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//make changes if old DB version number is less than 2</span>
    <span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
      keyPath<span class="token operator">:</span> <span class="token string">'bookid'</span><span class="token punctuation">,</span>
      <span class="token comment">//the required unique id property for each of the Store's documents</span>
      autoIncrement<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//create a new store that will hold documents about books.</span>
    <span class="token keyword">let</span> bookStore <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'bookList'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//we can create indexes on the various properties expected in the documents.</span>
    <span class="token keyword">var</span> titleIndex <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'by_title'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//we use indexes for sorting and searching our results.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
dbOpenRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//an error has happened during opening</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
dbOpenRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">DB</span> <span class="token operator">=</span> dbOpenRequest<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token comment">//or ev.target.result</span>
  <span class="token comment">//result will be the reference to the database that you will use</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">DB</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">DB</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">DB</span><span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//list of all the store names.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>Each time you want to work with the data inside a <code>Store</code> you need to use a <code>transaction</code> object. We create the <code>transaction</code> object and then use the transaction's <code>objectStore</code> method to access the one or more stores that will be used.</p> <p>Then we would call one of the ObjectStore methods. Each method will return a Request object. When the method request is complete, it will trigger the <code>complete</code> event on the transaction.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//storeName is a String or an Array</span>
<span class="token comment">//mode is 'readonly' or 'readwrite'</span>
<span class="token keyword">let</span> bookStore <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'bookStore'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// bookStore.count(); number of documents in the store</span>
<span class="token comment">// bookStore.add(); add a new document</span>
<span class="token comment">// bookStore.put(obj, key); update a document or insert if it doesn't exist</span>
<span class="token comment">// bookStore.delete(); delete a document</span>
<span class="token comment">// bookStore.get(key); get a single document whose key matches</span>
<span class="token comment">// bookStore.getKey(keyRange); get a get from a key range</span>
<span class="token comment">// bookStore.getAll(query); get all the documents that match</span>
<span class="token comment">// Each of these methods returns a request object that will have</span>
<span class="token comment">// a success event and an error event</span>

tx<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//error happened</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//the transaction has run and given us the result, if any</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>The <code>readonly</code> mode is used for retrieving data from the database. All the other operations need to use <code>readwrite</code>.</p> <p>We will use <code>transaction -&gt; store -&gt; method</code> as the approach for all our data operations with the database.</p> <p>We can make as many method requests as we want on a store inside transaction. We would use the <code>success</code> event for each method request as the trigger for making the next method request. As an example, we could <code>get()</code> a record, and then call <code>put()</code> to make a change to it.</p> <h2 id="reading-data-crud"><a href="#reading-data-crud" class="header-anchor">#</a> Reading Data (cRud)</h2> <p>To read the data we will use the <code>get(key)</code> or <code>getAll(query)</code> methods. <code>get</code> will fetch a single document whose key matches the provided one. The property that was defined as the <code>keyPath</code> when the <code>store</code> was created is the key that we are matching. Alternatively, you can pass a <code>keyRange</code> to the <code>get</code> method.</p> <p>The <code>getAll</code> method accepts a <code>KeyRange</code> object as the query to match. A <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBKeyRange" target="_blank" rel="noopener noreferrer">KeyRange Object<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> provides a lower and/or upper range bounding value(s). It will return all the documents that fall within the defined range. If you call the <code>getAll</code> method without a range then all documents in the <code>store</code> will be returned.</p> <p>Here is an example of fetching a single <code>document</code> from a <code>store</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> storeName <span class="token operator">=</span> <span class="token string">'bookStore'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'failed to successfully run the transaction'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished the transaction... wanna do something else'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bookStore <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bookid <span class="token operator">=</span> <span class="token string">'9781484257371'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> getRequest <span class="token operator">=</span> bookStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>bookid<span class="token punctuation">)</span><span class="token punctuation">;</span>
getRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//error with get request... will trigger the tx.onerror too</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
getRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> getRequest<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> obj <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//will then trigger the tx.oncomplete</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Here is an example of fetching a bunch of documents that fall within a range.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> storeName <span class="token operator">=</span> <span class="token string">'bookStore'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'failed to successfully run the transaction'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished the transaction... wanna do something else'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bookStore <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> range <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> getRequest <span class="token operator">=</span> bookStore<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//range will be compared to the keyPath as well as any Store indexes</span>
getRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//error with the getAll</span>
  <span class="token comment">//this will trigger the tx.onerror too</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
getRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> getRequest<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token comment">//in this case it will be an Array</span>
  result<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> doc <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//this will trigger the tx.oncomplete now</span>
  <span class="token comment">//OR we could call another method here</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>A Key Range is create with a few different methods called on the <code>IDBKeyRange</code> object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//match things higher in value than this</span>
IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//match things higher or equal to this</span>
IDBKeyRange<span class="token punctuation">.</span><span class="token function">upperBound</span><span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//match things lower in value than this</span>
IDBKeyRange<span class="token punctuation">.</span><span class="token function">upperBound</span><span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//match things lower or equal</span>
IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//match things between these</span>
IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//between or equal to these values</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Any of these methods will return a key range object that can be used in the various method requests on the ObjectStore.</p> <h2 id="inserting-data-crud"><a href="#inserting-data-crud" class="header-anchor">#</a> Inserting Data (Crud)</h2> <p>Inserting a new document into the database is done with the <code>add</code> method request. This is the <strong>CREATE</strong> part of the <strong>CRUD</strong> operations.</p> <p>When you are creating a database this is typically the first operation that you will do, since your database is of no value without data in it.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> storeName <span class="token operator">=</span> <span class="token string">'bookStore'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'failed to successfully run the transaction'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished the transaction... wanna do something else'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bookStore <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> newBook <span class="token operator">=</span> <span class="token punctuation">{</span>
  bookid<span class="token operator">:</span> <span class="token number">9876543210123</span><span class="token punctuation">,</span>
  title<span class="token operator">:</span> <span class="token string">'Cool Web Stuff'</span><span class="token punctuation">,</span>
  author<span class="token operator">:</span> <span class="token string">'Steve Griffith'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> addReq <span class="token operator">=</span> bookStore<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newBook<span class="token punctuation">)</span><span class="token punctuation">;</span>
addReq<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//failed insert</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
addReq<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'book document added'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//tx.oncomplete called now</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="updating-data-crud"><a href="#updating-data-crud" class="header-anchor">#</a> Updating Data (crUd)</h2> <p>Updating documents in the database store is done with the <code>put</code> method. You can pass in a document object or a document object and a key. If the key matches or the keyPath value in your object matches another document's key value in the store then an update will be done.</p> <p>If there is no match for the keyPath value then the <code>put</code> method will do an insert.</p> <p>The steps that you carry out before the <code>put</code> are the same as the ones that you do before an <code>add</code> or <code>delete</code> or <code>get</code> or <code>getAll</code> method request.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> storeName <span class="token operator">=</span> <span class="token string">'bookStore'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'failed to successfully run the transaction'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished the transaction... wanna do something else'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bookStore <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> book <span class="token operator">=</span> <span class="token punctuation">{</span>
  bookid<span class="token operator">:</span> <span class="token number">9876543210123</span><span class="token punctuation">,</span>
  title<span class="token operator">:</span> <span class="token string">'REALLLLY Cool Web Stuff'</span><span class="token punctuation">,</span>
  author<span class="token operator">:</span> <span class="token string">'Steve Griffith'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> upsertReq <span class="token operator">=</span> bookStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//will replace the existing book because it has the same bookid</span>
upsertReq<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//failed update</span>
  <span class="token comment">//tx.onerror triggered now</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
upsertReq<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Book updated'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//tx.oncomplete triggered now</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="deleting-data-crud"><a href="#deleting-data-crud" class="header-anchor">#</a> Deleting Data (cruD)</h2> <p>When we need to delete documents from our database store then we use the <code>delete</code> method and pass it a key or a keyRange. Passing in a keyRange can delete multiple documents at the same time. Always be careful with your delete operations because there is no undo.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> storeName <span class="token operator">=</span> <span class="token string">'bookStore'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'failed to successfully run the transaction'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished the transaction... wanna do something else'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bookStore <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bookid <span class="token operator">=</span> <span class="token string">'9781484257371'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> delReq <span class="token operator">=</span> bookStore<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>bookid<span class="token punctuation">)</span><span class="token punctuation">;</span>
delReq<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//error trying to delete</span>
  <span class="token comment">//tx.onerror triggered now</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
delReq<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//tx.oncomplete will be triggered now</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'document deleted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="using-cursors"><a href="#using-cursors" class="header-anchor">#</a> Using Cursors</h2> <p>A cursor is a common way to step through all the documents retrieved by a <code>getAll</code> method request. We can create a cursor from one of the indexes that we created in our Store.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> storeName <span class="token operator">=</span> <span class="token string">'bookStore'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>storeName<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'failed to successfully run the transaction'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished the transaction... wanna do something else'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> store <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>storeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//access the index from the store</span>
<span class="token keyword">let</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'by_title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//the one we created above</span>
<span class="token comment">//create the range that will be applied to the store via the index</span>
<span class="token keyword">let</span> range <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//create our cursor</span>
<span class="token comment">//next, nextunique, prev, prevunique</span>
<span class="token keyword">let</span> cursor <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>range<span class="token punctuation">,</span> <span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cursor<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//called each time a value is retrieved from the cursor</span>
  <span class="token keyword">let</span> cursorObj <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span> <span class="token comment">//or cursor.result</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursorObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursorObj<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cursorObj<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//triggers cursor.onsuccess again</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end of cursor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
cursor<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//an error when accessing the cursor or creating the cursor</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="what-to-do-this-week"><a href="#what-to-do-this-week" class="header-anchor">#</a> What to do this week</h2> <div class="custom-block warning"><p class="custom-block-title">TODO</p> <p>Things to do before next week</p> <ul><li>Complete <a href="/W2022/assignments/exer/">Exercise 1: IndexedDB</a></li> <li>Read and Watch all the content from <code>Modules 2.1, 2.2, and 3.1</code>.</li> <li>Watch the <a href="https://www.youtube.com/watch?v=6fK1K28eoUA&amp;list=PLyuRouwmQCjmNyAysdqjNz5fIS5cYU4vi" target="_blank" rel="noopener noreferrer">IndexedDB API Playlist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Prepare questions to ask in class.</li> <li>Finish working on <a href="/W2022/assignments/hybrid/">Hybrid one</a> and submit it.</li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/11/2022, 12:49:40 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/W2022/modules/week2/cookie-webstorage/" class="prev">
        2.1: Cookies, LocalStorage, Cache
      </a></span> <span class="next"><a href="/W2022/modules/week3/code-organizing/">
        3.1: ES Modules
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/W2022/assets/js/app.86fc79ff.js" defer></script><script src="/W2022/assets/js/2.644458f3.js" defer></script><script src="/W2022/assets/js/39.10bff2ae.js" defer></script><script src="/W2022/assets/js/8.c8690475.js" defer></script>
  </body>
</html>
