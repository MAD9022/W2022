(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{497:function(t,e,s){t.exports=s.p+"assets/img/screen-1-same-domain.61c6731e.gif"},498:function(t,e,s){t.exports=s.p+"assets/img/screen-2-cross-origin.d0d280fa.gif"},499:function(t,e,s){t.exports=s.p+"assets/img/computer-says-no.8060afc9.gif"},500:function(t,e,s){t.exports=s.p+"assets/img/screen-3-comparing.18548521.gif"},501:function(t,e,s){t.exports=s.p+"assets/img/youre-gonna-have-a-bad-time.d6242ce6.jpeg"},555:function(t,e,s){"use strict";s.r(e);var a=s(38),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[t._v("#")]),t._v(" CORS")]),t._v(" "),a("h2",{attrs:{id:"what-is-a-domain-or-origin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-a-domain-or-origin"}},[t._v("#")]),t._v(" What is a Domain or Origin?")]),t._v(" "),a("p",[t._v("A "),a("code",[t._v("domain")]),t._v(" refers to the name we give to a webserver's ip address. We could be talking about anything on specific computer or a specific folder on a specific computer. "),a("code",[t._v("example.com")]),t._v(" is a domain name. he "),a("code",[t._v(".com")]),t._v(" part is called the super domain. We can also add a subdomain like "),a("code",[t._v("www")]),t._v(" in front of the domain to get "),a("code",[t._v("www.example.com")]),t._v(". This would be called a Full qualified domain name.")]),t._v(" "),a("YouTube",{attrs:{title:"parts of the url",url:"https://www.youtube.com/embed/3ytQJvqzKu8"}}),t._v(" "),a("p",[t._v("An "),a("code",[t._v("origin")]),t._v(" refers to a domain name PLUS a protocol, like "),a("code",[t._v("https:")]),t._v(" and a port number. Eg: "),a("code",[t._v(":80")]),t._v(". All together the origin would look like this - "),a("code",[t._v("https://www.example.com:80")]),t._v(". That is an origin.")]),t._v(" "),a("p",[t._v("When an HTML file is loaded by a user-agent , typically a browser, the origin of that HTML file defines the "),a("code",[t._v("origin")]),t._v(" for everything else that happens on a webpage.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(497),alt:"same origin"}})]),t._v(" "),a("p",[t._v("In this image we are seeing a fetch request for "),a("code",[t._v("application/json")]),t._v(" data being sent from the script that is being run from the origin "),a("code",[t._v("https://www.mywebsite.com")]),t._v(". The "),a("code",[t._v("GET")]),t._v(" request is being sent to "),a("code",[t._v("https://api.mywebsite.com")]),t._v(". The protocol, ports, and domain names match so the response is allowed and the script is able to display the data on the page.")]),t._v(" "),a("h2",{attrs:{id:"what-does-cross-origin-mean"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-does-cross-origin-mean"}},[t._v("#")]),t._v(" What Does Cross-Origin Mean?")]),t._v(" "),a("p",[t._v("The browser downloads and reads the HTML file looking for other assets to load. If any of those assets come from a different "),a("code",[t._v("origin")]),t._v(" than the HTML file, then we are talking about a cross-origin request.")]),t._v(" "),a("p",[t._v("If the browser is making a simple request for assets that will be displayed directly on the page with no client-side processing then we are allowed.")]),t._v(" "),a("p",[t._v("If we are using JavaScript to get the asset, this opens up the possibility of malicious data interacting with your script and gaining access to user data. Now our "),a("code",[t._v("cross-origin")]),t._v(" request can be intercepted by the browser based on the "),a("code",[t._v("same-origin")]),t._v(" policy.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(498),alt:"cross-origin"}})]),t._v(" "),a("p",[t._v("In this second example, we are making the request from "),a("code",[t._v("https://anotherwebsite.com")]),t._v(". The origins are different so the the "),a("code",[t._v("same-origin")]),t._v(" policy kicks in and says no.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(499),alt:"computer says no"}})]),t._v(" "),a("h2",{attrs:{id:"bad-ports"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bad-ports"}},[t._v("#")]),t._v(" Bad Ports")]),t._v(" "),a("p",[t._v("It is worth noting that while you can generally make "),a("code",[t._v("fetch")]),t._v(" requests to your server and respond to them over any port that you want, there are some that are considered "),a("strong",[t._v("BAD")]),t._v(".")]),t._v(" "),a("p",[t._v("If the "),a("code",[t._v("port")]),t._v(" you are using appears in this list then your "),a("code",[t._v("fetch")]),t._v(" call will be denied by the browser.")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Port")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Typical service")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("tcpmux")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("7")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("echo")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("9")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("discard")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("11")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("systat")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("13")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("daytime")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("15")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("netstat")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("17")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("qotd")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("19")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("chargen")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("20")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ftp-data")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("21")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ftp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("22")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ssh")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("23")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("telnet")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("25")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("smtp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("37")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("time")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("42")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("name")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("43")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("nicname")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("53")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("domain")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("69")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("tftp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("77")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("—")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("79")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("finger")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("87")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("—")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("95")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("supdup")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("101")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("hostname")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("102")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("iso-tsap")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("103")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("gppitnp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("104")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("acr-nema")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("109")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("pop2")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("110")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("pop3")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("111")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("sunrpc")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("113")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("auth")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("115")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("sftp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("117")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("uucp-path")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("119")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("nntp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("123")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ntp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("135")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("epmap")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("137")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("netbios-ns")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("139")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("9 netbios-ssn")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("143")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("imap")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("161")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("snmp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("179")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("bgp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("389")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ldap")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("427")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("svrloc")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("465")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("submissions")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("512")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("exec")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("513")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("login")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("514")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("shell")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("515")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("print err")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("526")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("tempo")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("530")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("courier")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("531")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("chat")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("532")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("netnews")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("540")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("uucp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("548")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("afp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("554")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("rtsp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("556")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("remotefs")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("563")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("nntps")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("587")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("submission")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("601")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("syslog-conn")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("636")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ldaps")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("993")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("imaps")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("995")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("pop3s")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1719")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("h323 gatestat")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1720")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("h323 hostcall")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1723")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("pptp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("2049")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("nfs")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("3659")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("apple-sasl")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("4045")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("npp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("5060")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("sip")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("5061")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("sips")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("6000")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("x11")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("6566")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("sane-port")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("6665")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ircu")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("6666")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ircu")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("6667")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ircu")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("6668")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ircu")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("6669")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ircu")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("6697")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ircs-u")])])])]),t._v(" "),a("h2",{attrs:{id:"same-origin-policy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#same-origin-policy"}},[t._v("#")]),t._v(" Same-Origin Policy")]),t._v(" "),a("p",[t._v("The "),a("code",[t._v("same-origin")]),t._v(" policy is implemented by all modern browsers and has been for years. You would have to go back to IE 10, whose long term support has officially ended, to find a browser that doesn't implement the CORS "),a("code",[t._v("same-origin")]),t._v(" policy.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(500),alt:"comparing origins"}})]),t._v(" "),a("p",[a("strong",[t._v("Rule One")]),t._v(" in this policy is that if the "),a("code",[t._v("origin")]),t._v(" of your HTML file is the same as the "),a("code",[t._v("origin")]),t._v(" of the resource that you are requesting with "),a("code",[t._v("fetch()")]),t._v(" then all is fine. Do whatever you want with the asset. Download it, parse it, process it, or display it on the page.")]),t._v(" "),a("p",[t._v("The challenges and rules come when you need an image or JSON data from a different "),a("code",[t._v("origin")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"not-the-same-origin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#not-the-same-origin"}},[t._v("#")]),t._v(" NOT the same origin")]),t._v(" "),a("p",[t._v("When a request is NOT covered by the "),a("code",[t._v("same-origin")]),t._v(" policy, that is when "),a("strong",[t._v("CORS")]),t._v(" kicks in.")]),t._v(" "),a("p",[t._v("When we make a "),a("code",[t._v("fetch")]),t._v(" call, we can add an options setting for "),a("code",[t._v("mode")]),t._v(" and set it to "),a("code",[t._v("cors")]),t._v(". We are explicitly telling the browser that we intend to make a "),a("code",[t._v("CORS")]),t._v(" request.")]),t._v(" "),a("p",[t._v("Try running this following line in the browser dev console.")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://cors-demo.glitch.me/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cors'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("We will get an error message that says something like this:")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Access to fetch at 'https://cors-demo.glitch.me/'\nfrom origin 'https://www.example.com' has\nbeen blocked by CORS policy:\nNo 'Access-Control-Allow-Origin' header is present\non the requested resource. If an opaque response\nserves your needs, set the request's mode\nto 'no-cors' to fetch the resource with CORS disabled.\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("This error message is actually telling us how to fix the problem.")]),t._v(" "),a("h2",{attrs:{id:"the-server-needs-to-help"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-server-needs-to-help"}},[t._v("#")]),t._v(" The Server Needs to Help")]),t._v(" "),a("p",[t._v("The requested resource is missing an "),a("code",[t._v("Access-Control-Allow-Origin")]),t._v(" header. The server needed to send us an HTTP Response which included that header and the value of that header needed to match the origin of our HTML file.")]),t._v(" "),a("p",[t._v("Here is another fetch request that you can test in the console.")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://cors-demo.glitch.me/allow-cors'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cors'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("This one is to a different end point "),a("code",[t._v("/allow-cors")]),t._v(". The end point name is not important. What is important are the headers in the response.")]),t._v(" "),a("p",[t._v("Open the network tab, find the request for the "),a("code",[t._v("/allow-cors")]),t._v(" endpoint, and click on it. You should see the headers listed now. Scroll down to the Response Headers section. And you should see this:")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("access-control-allow-origin: *\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("That is the wildcard character, meaning that ALL origins are allowed to request this resource.")]),t._v(" "),a("blockquote",[a("p",[t._v("Note: if a request requires credentials then there must be an exact match for the origin. The wildcard character is NOT acceptable.")])]),t._v(" "),a("p",[t._v("Ever want to protect a JSON resource so it can only be used on your own website? Server-side, add this header to all responses so that it can only be accessed by your own domain.")]),t._v(" "),a("p",[t._v("With a NodeJS server using Express, it would look something like this:")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/my-resource'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-control-allow-origin'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://example.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('{"API-KEY":"123abcdef456"}')]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("Now, only requests that are coming from "),a("code",[t._v("https://example.com")]),t._v(" would be allowed to open and view that data.")]),t._v(" "),a("p",[t._v("These rules and steps may seem painful for developers to work around but there are real security risks that we are protecting our users from by the browser forcing us to follow the steps.")]),t._v(" "),a("h2",{attrs:{id:"preflight-requests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preflight-requests"}},[t._v("#")]),t._v(" Preflight Requests")]),t._v(" "),a("p",[t._v("When a browser has decided that you are not doing a "),a("code",[t._v("same-origin")]),t._v(" request and it needs to do a CORS test, then it will make a "),a("strong",[t._v("preflight request")]),t._v(".")]),t._v(" "),a("p",[t._v("Basically, it is still a "),a("code",[t._v("fetch")]),t._v(" request but it uses the "),a("code",[t._v("OPTIONS")]),t._v(" method, a smaller set of headers, and NO data or encoded files are sent to or received from the server.")]),t._v(" "),a("p",[t._v("The browser wants to know if it is allowed to talk to the server and request files of a specific "),a("code",[t._v("mime-type")]),t._v(" from that origin, for its own current origin.")]),t._v(" "),a("h2",{attrs:{id:"simple-requests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-requests"}},[t._v("#")]),t._v(" Simple Requests")]),t._v(" "),a("p",[t._v("Once we are past the "),a("code",[t._v("same-origin")]),t._v(" policy check the browser will next check to see if the Request is a "),a("strong",[t._v("simple request")]),t._v(". A simple request will "),a("strong",[t._v("NOT")]),t._v(" trigger a pre-flight request.")]),t._v(" "),a("p",[t._v("A request is simple if it:")]),t._v(" "),a("ol",[a("li",[t._v("Uses "),a("code",[t._v("GET")]),t._v(", "),a("code",[t._v("POST")]),t._v(", or "),a("code",[t._v("HEAD")]),t._v(".")]),t._v(" "),a("li",[t._v("If headers are added by the script they are only these ones:")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Accept")]),t._v(" * Safari has extra restrictions on values for this.")]),t._v(" "),a("li",[a("code",[t._v("Accept-Language")]),t._v(" * Safari has extra restrictions on values for this.")]),t._v(" "),a("li",[a("code",[t._v("Content-Language")]),t._v(" * Safari has extra restrictions on values for this.")]),t._v(" "),a("li",[a("code",[t._v("Content-Type")])])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("If a "),a("code",[t._v("Content-Type")]),t._v(" header was added, it only has one of these values:")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("text/plain")])]),t._v(" "),a("li",[a("code",[t._v("application/x-www-form-urlencoded")])]),t._v(" "),a("li",[a("code",[t._v("multipart/form-data")])])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("If using the old "),a("code",[t._v("XMLHttpRequest")]),t._v(" object, there is no listener for the "),a("code",[t._v("upload")]),t._v(" event.")]),t._v(" "),a("li",[t._v("No "),a("code",[t._v("ReadableStream")]),t._v(" object is added to the request.")])]),t._v(" "),a("p",[t._v("So, again, if it is a Simple Request, there will be no pre-flight request and everything is allowed to proceed.")]),t._v(" "),a("h2",{attrs:{id:"not-so-simple"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#not-so-simple"}},[t._v("#")]),t._v(" Not So Simple")]),t._v(" "),a("p",[t._v("If the request is determined to NOT be a simple request then the preflight request is sent using the "),a("code",[t._v("OPTIONS")]),t._v(" method.")]),t._v(" "),a("p",[t._v("When the browser receive the response to the preflight request, it looks for the "),a("code",[t._v("access-control-allow-origin")]),t._v(" header and compares it to your "),a("code",[t._v("origin")]),t._v(" header.")]),t._v(" "),a("p",[t._v("If the two do NOT match, then the "),a("code",[t._v("fetch")]),t._v(" request is denied and you get the error message in the console, that we saw above.")]),t._v(" "),a("h2",{attrs:{id:"other-access-control-headers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#other-access-control-headers"}},[t._v("#")]),t._v(" Other Access-Control- Headers")]),t._v(" "),a("p",[t._v("There are actually other "),a("code",[t._v("Headers")]),t._v(" in the "),a("code",[t._v("Request")]),t._v(" and the "),a("code",[t._v("Response")]),t._v(" that start with "),a("code",[t._v("Access-Control-")]),t._v(".")]),t._v(" "),a("p",[t._v("Here is an example of a preflight request and response.")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("OPTIONS /doc HTTP/1.1\nHost: bar.other\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:71.0) Gecko/20100101 Firefox/81.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-us,en;q=0.5\nAccept-Encoding: gzip,deflate\nConnection: keep-alive\nOrigin: http://foo.example\nAccess-Control-Request-Method: POST\nAccess-Control-Request-Headers: X-PINGOTHER, Content-Type\n\nHTTP/1.1 204 No Content\nDate: Mon, 29 Mar 2021 01:15:39 GMT\nServer: Apache/2\nAccess-Control-Allow-Origin: https://foo.example\nAccess-Control-Allow-Methods: POST, GET, OPTIONS\nAccess-Control-Allow-Headers: X-PINGOTHER, Content-Type\nAccess-Control-Max-Age: 86400\nVary: Accept-Encoding, Origin\nKeep-Alive: timeout=2, max=100\nConnection: Keep-Alive\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br")])]),a("p",[t._v("In the Request we are using "),a("code",[t._v("*-Request-Method")]),t._v(" to explain what we want to do after the preflight. We are using "),a("code",[t._v("*-Request-Headers")]),t._v(" to list the headers that we will be adding via Script to the actual request.")]),t._v(" "),a("p",[t._v("In the Response we are getting "),a("code",[t._v("*-Allow-Origin")]),t._v(" for the browser to compare to our "),a("code",[t._v("origin")]),t._v(" header from the Request. We get "),a("code",[t._v("*-Allow-Methods")]),t._v(" to say what the server is willing to accept for that endpoint. We get "),a("code",[t._v("*-Allow-Headers")]),t._v(" to confirm that we are allowed to use those custom headers in our full request. And finally, we get "),a("code",[t._v("*-Max-Age")]),t._v(" to say that this response will be valid for 86400 seconds (24 hours).")]),t._v(" "),a("p",[t._v("There is also a "),a("code",[t._v("Access-Control-Allow-Credentials")]),t._v(" Response header to indicate whether or not cookies and authentication information is being sent and received. See the "),a("a",{attrs:{href:"#HTML-crossorigin-attribute"}},[t._v("HTML crossorigin attribute notes")]),t._v(" att the bottom of this page for an example of sending those credentials.")]),t._v(" "),a("p",[t._v("If you want to send these credentials with your "),a("code",[t._v("fetch")]),t._v(" request then add this to the options object in your fetch call. The value can be either "),a("code",[t._v("omit")]),t._v(" or "),a("code",[t._v("include")]),t._v(". The default value is "),a("code",[t._v("omit")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cors'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  credentials"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'include'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("blockquote",[a("p",[t._v("You won't see a "),a("code",[t._v("credentials")]),t._v(" header in your Request. If you set it to "),a("code",[t._v("include")]),t._v(", then you will see the "),a("code",[t._v("cookies")]),t._v(" and "),a("code",[t._v("authentication")]),t._v(" headers as required.")])]),t._v(" "),a("p",[t._v("Another response header is "),a("code",[t._v("Access-Control-Expose-Headers")]),t._v(" which is a list of custom headers that are not just allowed by the server, but ones that you are allowed to access through the Response with JavaScript.")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Access-Control-Expose-Headers: X-My-Custom-Header, X-Another-Custom-Header\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("If we got this response in our preflight request then we "),a("strong",[t._v("would")]),t._v(" be able to do this.")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-My-Custom-Header'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-Another-Custom-Header'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h2",{attrs:{id:"request-modes-for-fetch-requests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#request-modes-for-fetch-requests"}},[t._v("#")]),t._v(" Request Modes for Fetch Requests")]),t._v(" "),a("p",[t._v("When making your "),a("code",[t._v("fetch")]),t._v(" call we can set a "),a("code",[t._v("mode")]),t._v(" option.")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  method"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("POST")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n  mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("cors")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  credentials"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'omit'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("You can define a mode for a fetch request such that only certain requests will resolve. The modes you can set are as follows:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("navigate")]),t._v(" You will see this value in the network tab of the browser dev tools. We cannot use this for a fetch because it means that the user-agent wants to replace the current document with the one being retrieved.")]),t._v(" "),a("li",[a("code",[t._v("same-origin")]),t._v(" only succeeds for requests for assets on the same origin, all other requests will reject.")]),t._v(" "),a("li",[a("code",[t._v("cors")]),t._v(" will allow requests for assets on the same-origin and other origins which return the appropriate CORs headers.")]),t._v(" "),a("li",[a("code",[t._v("cors-with-forced-preflight")]),t._v(" will always perform a preflight check before making the actual request.")]),t._v(" "),a("li",[a("code",[t._v("no-cors")]),t._v(" is intended to make requests to other origins that do not have CORS headers and result in an opaque response, but, this isn't possible in the window global scope at the moment.")])]),t._v(" "),a("h2",{attrs:{id:"preflight-responses"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preflight-responses"}},[t._v("#")]),t._v(" Preflight Responses")]),t._v(" "),a("p",[t._v("If the browser gets to the point of sending a preflight request, when the response comes back from the server, then the primary requirement is this:")]),t._v(" "),a("p",[t._v("The "),a("code",[t._v("origin")]),t._v(" Request header value "),a("strong",[t._v("MUST")]),t._v(" match the value in the "),a("code",[t._v("Access-Control-Allow-Origin")]),t._v(" Response header.")]),t._v(" "),a("p",[t._v("If this does not happen then you will get that error.")]),t._v(" "),a("h2",{attrs:{id:"what-is-an-opaque-response"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-an-opaque-response"}},[t._v("#")]),t._v(" What is an Opaque Response")]),t._v(" "),a("p",[t._v("An opaque response is for a request made for a resource on a different origin that doesn't return CORS headers. With an opaque response we won't be able to read the data returned or view the status of the request, meaning we can't check if the request was successful or not.")]),t._v(" "),a("p",[t._v("We get a response from the server. Just not a usable one.")]),t._v(" "),a("p",[t._v("Did you fetch an image and you now want to put it into a "),a("code",[t._v("<canvas>")]),t._v(" element? That means being able to access the actual data in the file. If you get an opaque response you would not be able to put the image into the "),a("code",[t._v("<canvas>")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"mime-type-failures"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mime-type-failures"}},[t._v("#")]),t._v(" Mime-Type Failures")]),t._v(" "),a("p",[t._v("Browsers can also do checks to see if the Response "),a("code",[t._v("Content-Type")]),t._v(" header matches what the content appears to be. For example, if the "),a("code",[t._v("Content-Type")]),t._v(" header says that the file is "),a("code",[t._v("text/plain")]),t._v(" but it is clearly a binary file like an "),a("code",[t._v("image/png")]),t._v(" then the browser can also reject the response.")]),t._v(" "),a("h2",{attrs:{id:"summary-of-steps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary-of-steps"}},[t._v("#")]),t._v(" Summary of Steps")]),t._v(" "),a("p",[t._v("If your request:")]),t._v(" "),a("ol",[a("li",[t._v("Does Not meet the "),a("code",[t._v("same-origin")]),t._v(" policy.")]),t._v(" "),a("li",[t._v("Uses a port from the BAD PORT list.")]),t._v(" "),a("li",[t._v("Does Not meet the Simple Request requirements.")]),t._v(" "),a("li",[t._v("Does Not successfully complete a preflight request and match the "),a("code",[t._v("origin")]),t._v(" with the "),a("code",[t._v("access-control-allow-origin")]),t._v(".")]),t._v(" "),a("li",[t._v("Does not meet the requirements of the other "),a("code",[t._v("Access-Control-*")]),t._v(" headers.")]),t._v(" "),a("li",[t._v("Does not have a valid "),a("code",[t._v("Content-Type")]),t._v(".")])]),t._v(" "),a("p",[t._v("Then...")]),t._v(" "),a("p",[a("img",{attrs:{src:s(501),alt:"have a bad time"}})]),t._v(" "),a("p",[t._v("Since you made it this far, we should also talk about "),a("RouterLink",{attrs:{to:"/modules/week5/api-fetch/corb.html"}},[t._v("CORB")]),t._v(".")],1),t._v(" "),a("h2",{attrs:{id:"html-crossorigin-attribute"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#html-crossorigin-attribute"}},[t._v("#")]),t._v(" HTML crossorigin attribute")]),t._v(" "),a("p",[t._v("While not directly connected with the CORS policy it is useful to discuss this attribute because it does have to do with "),a("code",[t._v("cross-origin")]),t._v(" security.")]),t._v(" "),a("p",[t._v("The crossorigin attribute, can be added to the "),a("code",[t._v("<audio>")]),t._v(", "),a("code",[t._v("<img>")]),t._v(", "),a("code",[t._v("<link>")]),t._v(", "),a("code",[t._v("<script>")]),t._v(", and "),a("code",[t._v("<video>")]),t._v(" elements, to provide support for CORS, by defining how the element handles "),a("code",[t._v("cross-origin")]),t._v(" requests, thereby enabling the configuration of the CORS requests for the element's fetched data. Depending on the element, the attribute can be a CORS settings attribute.")]),t._v(" "),a("p",[t._v("The values for the attribute are "),a("code",[t._v("anonymous")]),t._v(" or "),a("code",[t._v("use-credentials")])]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://picsum.photos/id/1023/300/300"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("crossorigin")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("use-credentials"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("alt")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("sample image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("Adding this attribute to those elements lets you decide whether or not identifying information along with those requests that are being sent to different origins.")]),t._v(" "),a("p",[t._v('If you needed to have a cookie set or other identifying information so that the server will allow you to get the asset, then you need to use the value "use-credentials".')]),t._v(" "),a("YouTube",{attrs:{title:"crossorigin attribute",url:"https://www.youtube.com/embed/m6lsF8z0hKk"}}),t._v(" "),a("h3",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN reference guide for CORS"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://fetch.spec.whatwg.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Official W3C spec for Fetch and CORS"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://dev.to/lydiahallie/cs-visualized-cors-5b8h",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dev.to article about CORS"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/modules/week5/api-fetch/"}},[t._v("Back to the Class 5.2 main page")])],1)],1)}),[],!1,null,null,null);e.default=n.exports}}]);